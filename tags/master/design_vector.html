<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>STXXL: Vector</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">STXXL
   &#160;<span id="projectnumber">1.4-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('design_vector.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Vector </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Roman Dementiev (2006)</dd></dl>
<p>The most universal STXXL container is <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a>. Vector is an array whose size can vary dynamically. The implementation of <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> is similar to the LEDA-SM array <a class="el" href="citelist.html#CITEREF_CraMeh99">[25]</a>. The content of a vector is striped block-wise over the disks, using an assignment strategy given as a template parameter. Some of the blocks are cached in a vector cache of fixed size (also a parameter). The replacement of cache blocks is controlled by a specified page-replacement strategy. STXXL has implementations of LRU and random replacement strategies. The user can provide his/her own strategy as well. The <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> has STL-compatible Random Access Iterators.</p>
<ul>
<li>One random access costs <img class="formulaInl" alt="$ \mathcal{O}(1) $" src="form_0.png"/> I/Os in the worst case. Same for insertion and removal at the end.</li>
<li>Sequential scanning of the vector costs <img class="formulaInl" alt="$ \mathcal{O}(1/DB) $" src="form_1.png"/> amortized I/Os per vector element.</li>
</ul>
<h1><a class="anchor" id="design_vector_architecture"></a>
The Architecture of stxxl::vector</h1>
<p>The <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> is organized as a collection of blocks residing on the external storage media (parallel disks). Access to the external blocks is organized through the fully associative <em>cache</em> which consist of some fixed amount of in-memory pages (The page is a collection of consecutive blocks. The number of blocks in the page is constant.). The schema of <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> is depicted in the following figure. When accessing an element the implementation of <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> access methods (<code>[]</code>operator, <code>push_back</code>, etc.) first checks whether the page to which the requested element belongs is in the vector's cache. If it is the case the reference to the element in the cache is returned. Otherwise the page is brought into the cache (If the page of the element has not been touched so far, this step is skipped. To keep an eye on such situations there is a special flag for each page.). If there was no free space in the cache, then some page is to be written out. Vector maintains a <em>pager</em> object, that tells which page to kick out. STXXL provides LRU and random paging strategies. The most efficient and default one is LRU. For each page vector maintains the <em>dirty</em> flag, which is set when <em>non-constant</em> reference to one of the page's elements was returned. The dirty flag is cleared each time when the page is read into the cache. The purpose of the flag is to track whether any element of the page is modified and therefore the page needs to be written to the disk(s) when it has to be evicted from the cache.</p>
<div class="image">
<img src="vector_architecture_small.png" alt="vector_architecture_small.png"/>
<div class="caption">
The schema of stxxl::vector that consists of ten external memory pages and has a cache with the capacity of four pages. The first cache page is mapped to external page 1, the second page is mapped to external page 8, and the fourth cache page is mapped to page 5. The third page is not assigned to any external memory page.</div></div>
<p> In the worst case scenario when vector elements are read/written in the random order each access takes 2 x blocks_per_page I/Os. The factor <em>two</em> shows up here because one has to write the replaced from cache page and read the required one). However the scanning of the array costs about <img class="formulaInl" alt="$ n/B $" src="form_2.png"/> I/Os using constant vector iterators or const reference to the vector, where <em>n</em> is the number of elements to read or write (read-only access). Using non-const vector access methods leads to <img class="formulaInl" alt="$ 2 \times n/B $" src="form_3.png"/> I/Os because every page becomes dirty when returning a non const reference. If one needs only to sequentially write elements to the vector in <img class="formulaInl" alt="$ n/B $" src="form_2.png"/> I/Os the currently fastest method is <a class="el" href="group__stlalgo.html#ga1f66b17c000502599f4b98a738094b3a">stxxl::generate</a>. Sequential writing to an untouched before vector (e.g. when created using <a class="el" href="classstxxl_1_1vector.html" title="External vector container.  Introduction to vector container: see STXXL Vector tutorial.  Design and Internals of vector container: see Vector. ">stxxl::vector(size_type n)</a> constructor.) or alone adding elements at the end of the vector, using the push_back(const T&amp;) method, leads also to <img class="formulaInl" alt="$ n/B $" src="form_2.png"/> I/Os.</p>
<div class="fragment"><div class="line"><span class="comment">// Example of use</span></div>
<div class="line"><a class="code" href="classstxxl_1_1vector.html">stxxl::vector&lt;int&gt;</a> V;</div>
<div class="line">V.<a class="code" href="classstxxl_1_1vector.html#a933ac891454518ac27d26becaeb21840">push_back</a>(3);</div>
<div class="line">assert(V.<a class="code" href="classstxxl_1_1vector.html#af4d6cf727b01fad8d46104b8c02ca611">size</a>() == 1 &amp;&amp; V.<a class="code" href="classstxxl_1_1vector.html#a65d7f27064b6d4c97d2594d7491de908">capacity</a>() &gt;= 1 &amp;&amp; V[0] == 3);</div>
</div><!-- fragment --><h1><a class="anchor" id="design_vector_generator"></a>
stxxl::VECTOR_GENERATOR</h1>
<p>Besides the type of the elements <a class="el" href="classstxxl_1_1vector.html" title="External vector container.  Introduction to vector container: see STXXL Vector tutorial.  Design and Internals of vector container: see Vector. ">stxxl::vector</a> has many other template parameters (block size, number of blocks per page, pager class, etc.). To make the configuration of the vector type easier STXXL provides special type generator template meta programs for its containers.</p>
<p>The meta-program for <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> is called <a class="el" href="structstxxl_1_1VECTOR__GENERATOR.html">stxxl::VECTOR_GENERATOR</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Example of use</span></div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="classstxxl_1_1vector.html">stxxl::VECTOR_GENERATOR&lt;int&gt;::result</a> vector_type;</div>
<div class="line">vector_type V;</div>
<div class="line">V.<a class="code" href="classstxxl_1_1vector.html#a933ac891454518ac27d26becaeb21840">push_back</a>(3);</div>
<div class="line">assert(V.size() == 1 &amp;&amp; V.capacity() &gt;= 1 &amp;&amp; V[0] == 3);</div>
</div><!-- fragment --><p>The <a class="el" href="structstxxl_1_1VECTOR__GENERATOR.html">stxxl::VECTOR_GENERATOR</a> has the following template parameters:</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">ValueType</td><td>element type of contained objects (POD with no references to internal memory) </td></tr>
    <tr><td class="paramname">PageSize</td><td>number of blocks in a page, default: <b>4</b> (recommended &gt;= D) </td></tr>
    <tr><td class="paramname">CachePages</td><td>number of pages in cache, default: <b>8</b> (recommended &gt;= 2) </td></tr>
    <tr><td class="paramname">BlockSize</td><td>external block size <em>B</em> in bytes, default: <b>2 MiB</b> </td></tr>
    <tr><td class="paramname">AllocStr</td><td>parallel disk allocation strategies: <code>striping</code>, <a class="el" href="structstxxl_1_1RC.html" title="Randomized cycling disk allocation scheme functor. ">RC</a>, <a class="el" href="structstxxl_1_1SR.html" title="Simple randomized disk allocation scheme functor. ">SR</a>, or <a class="el" href="structstxxl_1_1FR.html" title="Fully randomized disk allocation scheme functor. ">FR</a>. default: <b><a class="el" href="structstxxl_1_1RC.html" title="Randomized cycling disk allocation scheme functor. ">RC</a></b>. </td></tr>
    <tr><td class="paramname">Pager</td><td>pager type: <code>random</code> or <code>lru</code>, default: <b>lru</b>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Do not store references to the elements of an external vector. Such references might be invalidated during any following access to elements of the vector</dd></dl>
<h3>Notes:</h3>
<ul>
<li>All blocks of a page are read and written from/to disks together. Therefore to increase the I/O bandwidth, it is recommended to set the PageSize parameter to multiple of <em>D</em>.</li>
<li>Memory consumption of constructed vector is BlockSize x CachePages x PageSize bytes (see below).</li>
<li>The configured vector type is available as <a class="el" href="structstxxl_1_1VECTOR__GENERATOR.html#acca0a7646e090e340cb277ba2f81d862">VECTOR_GENERATOR&lt;&gt;::result</a>.</li>
<li>Since there are defaults for the last five of the parameters, it is not necessary to specify them all.</li>
<li>Supported parallel disk assignment strategies: <table class="doxtable">
<tr>
<th>strategy </th><th>identifier  </th></tr>
<tr>
<td>striping </td><td>striping </td></tr>
<tr>
<td>simple randomized </td><td><a class="el" href="structstxxl_1_1SR.html" title="Simple randomized disk allocation scheme functor. ">SR</a> </td></tr>
<tr>
<td>fully randomized </td><td><a class="el" href="structstxxl_1_1FR.html" title="Fully randomized disk allocation scheme functor. ">FR</a> </td></tr>
<tr>
<td>randomized cycling </td><td><a class="el" href="structstxxl_1_1RC.html" title="Randomized cycling disk allocation scheme functor. ">RC</a> </td></tr>
</table>
</li>
<li>Supported paging strategies: <table class="doxtable">
<tr>
<th>strategy </th><th>identifier  </th></tr>
<tr>
<td>random </td><td>random </td></tr>
<tr>
<td>least recently used </td><td>lru </td></tr>
</table>
<h3>Examples:</h3>
</li>
</ul>
<ul>
<li><a class="el" href="structstxxl_1_1VECTOR__GENERATOR.html#acca0a7646e090e340cb277ba2f81d862">VECTOR_GENERATOR&lt;double&gt;::result</a> &ndash; external vector of <b>double's</b> with four blocks per page, the cache with eight pages, 2 MiB blocks, Random Allocation and lru cache replacement strategy.</li>
<li><a class="el" href="structstxxl_1_1VECTOR__GENERATOR.html#acca0a7646e090e340cb277ba2f81d862">VECTOR_GENERATOR&lt;double,8&gt;::result</a> &ndash; external vector of <b>double's</b> , with <b>eight</b> blocks per page, the cache with eight pages, 2 MiB blocks, Random Allocation and lru cache replacement strategy</li>
<li><a class="el" href="structstxxl_1_1VECTOR__GENERATOR.html#acca0a7646e090e340cb277ba2f81d862">VECTOR_GENERATOR&lt;double,8,2,524288,SR&gt;::result</a> &ndash; external vector of <b>double's</b>, with <b>eight</b> blocks per page, the cache with <b>two</b> pages, <b>512</b> KiB blocks, <b>Simple Randomized</b> allocation and lru cache replacement strategy</li>
</ul>
<h1><a class="anchor" id="design_vector_memory"></a>
Internal Memory Consumption of stxxl::vector</h1>
<p>The cache of <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> largely dominates in its internal memory consumption. Other members consume very small fraction of <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a>'s memory even when the vector size is large. Therefore, the internal memory consumption of <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a> can be estimated as <img class="formulaInl" alt="$ BlockSize \times CachePages \times PageSize $" src="form_4.png"/> bytes.</p>
<h1><a class="anchor" id="design_vector_notes"></a>
More Notes</h1>
<ul>
<li>In opposite to STL, <a class="el" href="classstxxl_1_1vector.html">stxxl::vector</a>'s iterators do not get invalidated when the vector is resized or reallocated.</li>
<li>Dereferencing a non-const iterator makes the page of the element to which the iterator points to <b>dirty</b>. This causes the page to be written back to the disks(s) when the page is to be kicked off from the cache (additional write I/Os). If you do not want this behavior, use const iterators instead. See following example: <div class="fragment"><div class="line">vector_type V;</div>
<div class="line"><span class="comment">// ... fill the vector here</span></div>
<div class="line"></div>
<div class="line">vector_type::iterator iter = V.begin();</div>
<div class="line"><span class="comment">// ... advance the iterator</span></div>
<div class="line">a = *iter; <span class="comment">// causes write I/Os, although *iter is not changed</span></div>
<div class="line"></div>
<div class="line">vector_type::const_iterator citer = V.begin();</div>
<div class="line"><span class="comment">// ... advance the iterator</span></div>
<div class="line">a = *citer; <span class="comment">// read-only access, causes no write I/Os</span></div>
<div class="line">*citer = b; <span class="comment">// does not compile, citer is const</span></div>
</div><!-- fragment --></li>
<li>Non const <code>operator</code>[] makes the page of the element <b>dirty</b>. This causes the page to be written back to the disks(s) when the page is to be kicked off from the cache (additional write I/Os). If you do not want this behavior, use const <code>operator</code>[]. For that you need to access the vector via a const reference to it. Example: <div class="fragment"><div class="line">vector_type V;</div>
<div class="line"><span class="comment">// ... fill the vector here</span></div>
<div class="line"></div>
<div class="line">a = V[index]; <span class="comment">// causes write I/Os, although V[index] is not changed</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> vector_type &amp; CV = V; <span class="comment">// const reference to V</span></div>
<div class="line">a = CV[index]; <span class="comment">// read-only access, can cause no write I/Os</span></div>
<div class="line">CV[index] = b; <span class="comment">// does not compile, CV is const</span></div>
</div><!-- fragment --> This issue also concerns <code>front()</code> and <code>back()</code> methods. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Welcome to STXXL</a></li><li class="navelem"><a class="el" href="design.html">Design of STXXL</a></li><li class="navelem"><a class="el" href="design_stl.html">The STL-User Layer</a></li><li class="navelem"><a class="el" href="design_stl_containers.html">STXXL Containers</a></li>
    <li class="footer"><a href="http://github.com/stxxl/stxxl/commit/0a80a8c55993948f7f2f6c2c5a51ff45b403045b">STXXL 1.4.1-380-g0a80a8c</a><script type="text/javascript">
var _paq = _paq || [];  _paq.push(['trackPageView']);  _paq.push(['enableLinkTracking']);  (function() {    var u='http://panthema.net/wik-331/';    _paq.push(['setTrackerUrl', u+'js/']);    _paq.push(['setSiteId', '1']);    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';    g.defer=true; g.async=true; g.src=u+'js/'; s.parentNode.insertBefore(g,s);  })();
</script>
<noscript><img src="http://panthema.net/wik-331/js/?idsite=1&amp;rec=1" style="border:0" alt="" /></noscript> - Generated on Sat Feb 11 2017 06:26:29 for STXXL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
